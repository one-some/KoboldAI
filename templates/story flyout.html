<div class="tabrow nomenu_icon">
	<span id="story_flyout_tab_context" class="story_menu_button tab tab-story selected" tab-target="story_menu_context" onclick="selectTab(this);">Context</span>
	<span id="story_flyout_tab_notes" class="story_menu_button tab tab-story" tab-target="story_menu_notes" onclick="selectTab(this);">Notes</span>
	<span id="story_flyout_tab_wi" class="story_menu_button tab tab-story" tab-target="story_menu_wi" onclick="selectTab(this);">World Info</span>
</div>
<div class="flyout_menu_contents">
	<div id="story_menu_context" class="story_category_area tab-target tab-target-story">
		<div id="Memory" class="menu-section">
			<h4 class="section_header"><label for="memory">Memory</label></h4>
			<div class="help_text">
				Important information the AI should always keep in mind.
			</div>
			<textarea rows=20 id="memory" class="var_sync_story_memory var_sync_alt_story_memory_length fullwidth" onchange='sync_to_server(this);' autocomplete="off"></textarea>
		</div>
		<div id="author_notes" class="menu-section">
			<h4 class="section_header">Author's Note</h4>
			<div class="help_text">
				Heavily influences the direction and style of the AI's writing.
			</div>

			<label for="authors_notes_template">Template:</label>
			<input autocomplete="off" id=authors_notes_template type=text placeholder="[Author's note: <|>]" class="var_sync_story_authornotetemplate fullwidth" onchange='sync_to_server(this);'>
			<label for="authors_notes">Author's Notes:</label>
			<textarea autocomplete="off" id="authors_notes" class="var_sync_story_authornote var_sync_alt_story_authornote_length fullwidth" onchange='sync_to_server(this);'></textarea>

			<div class="setting_tile_area">
				{% with menu='author_notes' %}
					{% with sub_path='' %}
						{% include 'settings item.html' %}
					{% endwith %}
				{% endwith %}
			</div>
		</div>

		<div id="cfg-menu-section" class="menu-section">
			<h4 class="section_header">Classifier-Free Guidance</h4>
			<div class="help_text">A different type of prompt to keep the AI on track.</div>
			<textarea
				autocomplete="off"
				class="var_sync_story_cfg_prompt fullwidth"
				onchange="sync_to_server(this);"
			></textarea>
			<div class="setting_tile_area">
				{% with menu='context' %}
					{% with sub_path='cfg' %}
						{% include 'settings item.html' %}
					{% endwith %}
				{% endwith %}
			</div>
		</div>

		<div id="Genre" class="menu-section">
			<h4 class="section_header">Genre</h4>
			<div class="help_text">Styles the AI will attempt to imitate. Effectiveness depends on model.</div>
			<input id="genre-input" class="fullwidth" placeholder="Fantasy" autocomplete="off" spellcheck="false">
			<div id="genre-suggestion-super-container">
				<div id="genre-suggestion-container"></div>
			</div>
			<div id="genre-container"></div>
		</div>

		<div id="Auto-Memory" class="var_sync_alt_system_experimental_features menu-section">
			<h4 class="section_header"><label for="auto_memory">Auto-Memory (non-functional)</label></h4>
			<div class="help_text">
				What the system would use for automatic memory summarized from the game
			</div>
			<button class="settings_button" onclick="socket.emit('refresh_auto_memory', {});">Generate</button>
			<textarea rows=20 id="auto_memory" class="var_sync_story_auto_memory fullwidth" autocomplete="off"></textarea>
		</div>
	</div>

	<div id="story_menu_notes" class="story_category_area tab-target tab-target-story hidden">
		<div id="Notes">
			<h4 class="section_header"><label for="notes">Notes</label></h4>
			<div class="help_text">
				Notes about the story. These notes are not read by the AI!
			</div>
			<textarea id="notes" autocomplete="off" rows=20 class="var_sync_story_notes fullwidth" onchange='sync_to_server(this);' oninput="autoResize(this)"></textarea>
		</div>
	</div>
	<div id="story_menu_wi" class="story_category_area tab-target tab-target-story hidden">
		<h4 class="section_header" style="margin-left: 12px;">World Info</h4>
		<div class="help_text" style="margin-left: 20px;">
			Lore information, which the AI recalls by certain words.
			<span class="helpicon material-icons-outlined" tooltip="Use this instead of Memory for information on things like characters, objects, events, places, and anything else with detail.">help_icon</span>
		</div>
		<div class="setting_tile_area wi_settings">
		{% with menu='World Info' %}
			{% with sub_path='' %}
				{% include 'settings item.html' %}
			{% endwith %}
		{% endwith %}
		</div>
		<div id="WI_Area">
			<span id="world_info_folder_New Folder" class="WI_Folder">
				<h2>
					<span id="world_info_folder_collapse_root" class="wi_folder_collapser material-icons-outlined" folder="root">expand_more</span>
					<span id="world_info_folder_expand_root" class="wi_folder_collapser material-icons-outlined hidden" folder="root">chevron_right</span>
					<span class="material-icons-outlined" folder="root">folder</span>
					<span class="wi_title" original_text="root" contenteditable="true">root</span>
				</h2>
				<span class="wi_add_button " onclick='create_new_wi_entry(this.getAttribute("folder"));'>
					<span class="material-icons-outlined">post_add</span>
					<span class="wi_add_text" folder="root">Add World Info Entry</span>
				</span>
			</span>
		</div>
	</div>
	<div id="token-breakdown-container" class="settings_footer" style="padding-top: 10px;">
		<div class="token_breakdown" onclick='socket.emit("update_tokens", document.getElementById("input_text").value);openPopup("context-viewer");'>
			<div id="soft_prompt_tokens" style="width:0%; background-color: var(--context_colors_soft_prompt);"></div>
			<div id="genre_tokens" style="width:40%; background-color: var(--context_colors_genre);"></div>
			<div id="memory_tokens" style="width:40%; background-color: var(--context_colors_memory);"></div>
			<div id="authors_notes_tokens" style="width:10%; background-color: var(--context_colors_authors_notes);"></div>
			<div id="world_info_tokens" style="width:20%; background-color: var(--context_colors_world_info);"></div>
			<div id="prompt_tokens" style="width:40%; background-color: var(--context_colors_prompt);"></div>
			<div id="game_text_tokens" style="width:10%; background-color: var(--context_colors_game_text);"></div>
			<div id="submit_tokens" style="width:20%; background-color: var(--context_colors_submit);"></div>
			<div id="unused_tokens" style="width:20%; background-color: var(--context_colors_unused);"></div>
		</div>
	</div>
</div>
